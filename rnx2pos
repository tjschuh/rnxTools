#!/bin/tcsh
#
# takes an unaltered RINEX .obs files and
# outputs the approx position along
# with the start and end times both listed
# in header to file called obsfiles.pos
#
# INPUT:
#
# OUTPUT:
#
# obsfiles.pos       contains XYZ approximate positions, start time, and end time
#
# Originally written by tschuh-at-princeton.edu, 06/25/2021
# Last modified by tschuh-at-princeton.edu, 06/29/2021

set files = `/usr/bin/ls *.obs`

touch obsfiles.pos

foreach file ($files[*]) 
    # Find the header bottom
    set nrh = `rnx2hdr $file`

    set fyr = `awk 'NR < '"$nrh"' && /TIME OF FIRST OBS/ {printf "%4.4i", $1}' $file`
    set fmo = `awk 'NR < '"$nrh"' && /TIME OF FIRST OBS/ {printf "%2.2i", $2}' $file`
    set fdy = `awk 'NR < '"$nrh"' && /TIME OF FIRST OBS/ {printf "%2.2i", $3}' $file`
    set fhr = `awk 'NR < '"$nrh"' && /TIME OF FIRST OBS/ {printf "%2.2i", $4}' $file`
    set fmn = `awk 'NR < '"$nrh"' && /TIME OF FIRST OBS/ {printf "%2.2i", $5}' $file`
    set fsc = `awk 'NR < '"$nrh"' && /TIME OF FIRST OBS/ {printf "%2.2i", $6}' $file`

    set lyr = `awk 'NR < '"$nrh"' && /TIME OF LAST OBS/ {printf "%4.4i", $1}' $file`
    set lmo = `awk 'NR < '"$nrh"' && /TIME OF LAST OBS/ {printf "%2.2i", $2}' $file`
    set ldy = `awk 'NR < '"$nrh"' && /TIME OF LAST OBS/ {printf "%2.2i", $3}' $file`
    set lhr = `awk 'NR < '"$nrh"' && /TIME OF LAST OBS/ {printf "%2.2i", $4}' $file`
    set lmn = `awk 'NR < '"$nrh"' && /TIME OF LAST OBS/ {printf "%2.2i", $5}' $file`
    set lsc = `awk 'NR < '"$nrh"' && /TIME OF LAST OBS/ {printf "%2.2i", $6}' $file`

    set pos = `awk '/APPROX POSITION/ {print $1,$2,$3}' $file`

    #set int = `rnx2epc $file`

    echo $pos "  " $fyr $fmo $fdy $fhr $fmn $fsc "  " $lyr $lmo $ldy $lhr $lmn $lsc  >> obsfiles.pos

end
